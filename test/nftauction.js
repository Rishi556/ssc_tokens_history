/* eslint-disable */
const assert = require('assert');
const { findTransaction, runParseBlock } = require('./common');


describe('nftauction', function () {

  it('parse nft auction result', async () => {
    await runParseBlock({ "_id" : 12990843, "blockNumber" : 12990843, "refHiveBlockNumber" : 59977668, "refHiveBlockId" : "03932fc4f40df374471d84286645e907cff2dffe", "prevRefHiveBlockId" : "03932fc3e16209ae7ab63f468739c56024d608e0", "previousHash" : "e11f8a0aed196fdb6b8b10142dd2a4185d0eac2e372aa6cbb9c1d66d021bcdb1", "previousDatabaseHash" : "44d98c31901bee1b56973dfd604d1deee6ebdb85407faa0154747714e45729a5", "timestamp" : "2021-12-12T16:52:21", "transactions" : [], "virtualTransactions" : [ { "refHiveBlockNumber" : 59977668, "transactionId" : "59977668-6", "sender" : "null", "contract" : "nftauction", "action" : "updateAuctions", "payload" : "", "executedCodeHash" : "9da592fcaa3d6cd1dceacf45c1e0a2a304c23c9834a5f8b1748d5d4e8c91f348c7336ce8834ebfc45a22eb081eb0813bf7d977c8a79de6f686eef314f9620003c7336ce8834ebfc45a22eb081eb0813bf7d977c8a79de6f686eef314f9620003c7336ce8834ebfc45a22eb081eb0813bf7d977c8a79de6f686eef314f9620003389babf88e5a3f8966d947525fc60bee5048ec4fa6abf3724198bffa30f7e5a9", "hash" : "6a74626dfdce75a18d16bffbed61e318c6ab30f2abccd25d657661b1553df34e", "databaseHash" : "948a0930fe8f2bc2a77e845bd276e4f74c69a8fb8157c25f16b047278ccbcb54", "logs" : "{\"events\":[{\"contract\":\"tokens\",\"event\":\"transferFromContract\",\"data\":{\"from\":\"nftauction\",\"to\":\"nftshowroom\",\"symbol\":\"SWAP.HIVE\",\"quantity\":\"0.08000000\"}},{\"contract\":\"tokens\",\"event\":\"transferFromContract\",\"data\":{\"from\":\"nftauction\",\"to\":\"nftshowroom\",\"symbol\":\"SWAP.HIVE\",\"quantity\":\"0.02000000\"}},{\"contract\":\"tokens\",\"event\":\"transferFromContract\",\"data\":{\"from\":\"nftauction\",\"to\":\"fredfettmeister\",\"symbol\":\"SWAP.HIVE\",\"quantity\":\"0.9\"}},{\"contract\":\"nft\",\"event\":\"transfer\",\"data\":{\"from\":\"nftauction\",\"fromType\":\"c\",\"to\":\"aichanbot\",\"toType\":\"u\",\"symbol\":\"NFTSR\",\"id\":\"43470\"}},{\"contract\":\"nftauction\",\"event\":\"settleAuction\",\"data\":{\"auctionId\":\"c232fa872e839f4aeeb5a1f98fbc0ad632123a91\",\"symbol\":\"NFTSR\",\"seller\":\"fredfettmeister\",\"nftIds\":[\"43470\"],\"bidder\":\"aichanbot\",\"price\":\"1\",\"priceSymbol\":\"SWAP.HIVE\",\"timestamp\":1639327941000,\"marketAccount\":\"nftshowroom\",\"fee\":\"0.08000000\",\"agentAccount\":\"nftshowroom\",\"agentFee\":\"0.02000000\"}}]}" } ], "hash" : "9b6873cd243f4ccef7374446f0e4cda2e15a767a6621958d5b75841ce58953cf", "databaseHash" : "fba7af16ee797178a7d90a3ce9f6d55e9bddb100f68bc0962d4b84559f564f03", "merkleRoot" : "d590c5a4c9887bbf5ee798db1ca4c9cb73b82b02082f5c83c012c40b203257ed", "round" : 476880, "roundHash" : "2a70cc1e2dad91cdcda6a693dc460899805a21921498c4da8eb2ba2bfd2ba0b4", "witness" : "neoxianminer", "signingKey" : "STM7J6H1z1NaRG7qWZqUKJaQBKgffoK3bLdAYhokgZu45evTWAP1V", "roundSignature" : "1f46a579dbc2bb8f4893f6a989c6bd04ce55917bd5940262b77e0a070bfff832a800ebcd5deb774eae3c54d4aa06758954f242c6cff6efbd32dbd52653e939265a" });
      const txId = '59977668-6';
      const block = await findTransaction(txId);
      block.forEach(t => delete t._id);
      assert.strictEqual(JSON.stringify(block), '[{"blockNumber":12990843,"transactionId":"59977668-6","timestamp":1639327941,"operation":"nftauction_updateAuctions","from":"contract_nftauction","to":"nftshowroom","symbol":"SWAP.HIVE","quantity":"0.08000000","memo":null,"account":"nftshowroom"},{"blockNumber":12990843,"transactionId":"59977668-6","timestamp":1639327941,"operation":"nftauction_updateAuctions","from":"contract_nftauction","to":"nftshowroom","symbol":"SWAP.HIVE","quantity":"0.02000000","memo":null,"account":"nftshowroom"},{"blockNumber":12990843,"transactionId":"59977668-6","timestamp":1639327941,"operation":"nftauction_updateAuctions","from":"contract_nftauction","to":"fredfettmeister","symbol":"SWAP.HIVE","quantity":"0.9","memo":null,"account":"fredfettmeister"},{"blockNumber":12990843,"transactionId":"59977668-6","timestamp":1639327941,"operation":"nftauction_updateAuctions","from":"contract_nftauction","to":"aichanbot","symbol":"NFTSR","nft":"43470","account":"aichanbot"}]');
  });

});
