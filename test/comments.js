/* eslint-disable */
const assert = require('assert');
const { findTransaction, runParseBlock } = require('./common');


describe('comments', function () {

  it('parse comment rewards', async () => {
    await runParseBlock({ "_id" : 13105772, "blockNumber" : 13105772, "refHiveBlockNumber" : 60092668, "refHiveBlockId" : "0394f0fc4088d9283d49e0cc346f4c7c5d7c11d1", "prevRefHiveBlockId" : "0394f0fbcb570c47ffb0c0dd9848c1fa1abf2a5a", "previousHash" : "3ccf8162ea252eed5feac0ef99c20d8866fb3c2e4c1150a5e2b59bdd539792dc", "previousDatabaseHash" : "67538345dd224a4f69f96173b7f0aa719c5d471ee9d4e4634c8c59b96fb377f3", "timestamp" : "2021-12-16T16:52:18", "transactions" : [ { "refHiveBlockNumber" : 60092668, "transactionId" : "debccb769b7d7208d448c199e6706c30b7b9bd09-0", "sender" : "null", "contract" : "comments", "action" : "comment", "payload" : "{\"author\":\"gamergeek56\",\"jsonMetadata\":{\"app\":\"hiveblog/0.1\"},\"parentAuthor\":\"pusen\",\"parentPermlink\":\"re-gamergeek56-r47w4m\",\"permlink\":\"r47w71\"}", "executedCodeHash" : "", "hash" : "5a4242de471116c9dc483f124b7973eb12362bfbbc227fd0ca144cca6c0e8be5", "databaseHash" : "ae199d20c5eda837f74cc36c8686ba0ae2c9187203a188de3439c4a3f7710539", "logs" : "{\"events\":[{\"contract\":\"tokens\",\"event\":\"issueToContract\",\"data\":{\"from\":\"tokens\",\"to\":\"comments\",\"symbol\":\"BUIDL\",\"quantity\":\"0.3\"}},{\"contract\":\"comments\",\"event\":\"curationReward\",\"data\":{\"rewardPoolId\":13,\"authorperm\":\"@rufans/hivefolks-i-m-a-shy\",\"symbol\":\"WAIV\",\"account\":\"rufans2\",\"quantity\":\"0.00027658\"}},{\"contract\":\"tokens\",\"event\":\"stakeFromContract\",\"data\":{\"account\":\"rufans2\",\"symbol\":\"WAIV\",\"quantity\":\"0.0001\"}},{\"contract\":\"tokens\",\"event\":\"transferFromContract\",\"data\":{\"from\":\"comments\",\"to\":\"rufans2\",\"symbol\":\"WAIV\",\"quantity\":\"0.00017658\"}},{\"contract\":\"comments\",\"event\":\"authorReward\",\"data\":{\"rewardPoolId\":13,\"authorperm\":\"@rufans/hivefolks-i-m-a-shy\",\"symbol\":\"WAIV\",\"account\":\"rufans\",\"quantity\":\"0.18136855\"}},{\"contract\":\"tokens\",\"event\":\"stakeFromContract\",\"data\":{\"account\":\"rufans\",\"symbol\":\"WAIV\",\"quantity\":\"0.0001\"}},{\"contract\":\"tokens\",\"event\":\"transferFromContract\",\"data\":{\"from\":\"comments\",\"to\":\"rufans\",\"symbol\":\"WAIV\",\"quantity\":\"0.18126855\"}}]}"}, { "refHiveBlockNumber" : 60092668, "transactionId" : "debccb769b7d7208d448c199e6706c30b7b9bd09-1", "sender" : "null", "contract" : "comments", "action" : "commentOptions", "payload" : "{\"author\":\"gamergeek56\",\"maxAcceptedPayout\":\"1000000.000 HBD\",\"allowVotes\":true,\"allowCurationRewards\":true,\"beneficiaries\":[],\"permlink\":\"r47w71\"}", "executedCodeHash" : "f712bf85c6b3e299ce4b0a5c4ef0deac5feeeba894b6e9693fd00b29d39f4bb7", "hash" : "5f631a44b9a381ee6263ba76dcfb7e4eb05be0807a533fb542dd084f2b12287d", "databaseHash" : "ae199d20c5eda837f74cc36c8686ba0ae2c9187203a188de3439c4a3f7710539", "logs" : "{}" } ], "virtualTransactions" : [ ], "hash" : "c2ae2e8becb7e34be7b7a5373b4ca96afbf60a574aadc5ab65762cf4bca75c2c", "databaseHash" : "09145bd0f4e0b6c51c31a2386ac7a6ffb3060faf5a03608c1e6504579758f0e4", "merkleRoot" : "6da50084870bad415cff0e4fc44c0edfc587fceafe0afd3da8a99c89ecfe2d63", "round" : null, "roundHash" : "", "witness" : "", "signingKey" : "", "roundSignature" : "" });
      const txId = 'debccb769b7d7208d448c199e6706c30b7b9bd09-0';
      const block = await findTransaction(txId);
      block.forEach(t => delete t._id);
      assert.strictEqual(JSON.stringify(block), '[{"blockNumber":13105772,"transactionId":"debccb769b7d7208d448c199e6706c30b7b9bd09-0","timestamp":1639673538,"operation":"comments_curationReward_stake","authorperm":"@rufans/hivefolks-i-m-a-shy","from":"contract_tokens","to":"rufans2","symbol":"WAIV","quantity":"0.0001","memo":null,"account":"rufans2"},{"blockNumber":13105772,"transactionId":"debccb769b7d7208d448c199e6706c30b7b9bd09-0","timestamp":1639673538,"operation":"comments_curationReward","authorperm":"@rufans/hivefolks-i-m-a-shy","from":"contract_comments","to":"rufans2","symbol":"WAIV","quantity":"0.00017658","memo":null,"account":"rufans2"},{"blockNumber":13105772,"transactionId":"debccb769b7d7208d448c199e6706c30b7b9bd09-0","timestamp":1639673538,"operation":"comments_authorReward_stake","authorperm":"@rufans/hivefolks-i-m-a-shy","from":"contract_tokens","to":"rufans","symbol":"WAIV","quantity":"0.0001","memo":null,"account":"rufans"},{"blockNumber":13105772,"transactionId":"debccb769b7d7208d448c199e6706c30b7b9bd09-0","timestamp":1639673538,"operation":"comments_authorReward","authorperm":"@rufans/hivefolks-i-m-a-shy","from":"contract_comments","to":"rufans","symbol":"WAIV","quantity":"0.18126855","memo":null,"account":"rufans"}]');
  });

});
